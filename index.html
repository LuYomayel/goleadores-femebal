<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Goleadores</title>
    <!-- CSS de Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Top Goleadores</h1>
        
        <div class="row">
            <div class="col-md-3">
                <select class="form-select mb-3" id="categoriasDropdown">
                    <option selected>Elegir categoría...</option>
                    <!-- Cargar opciones de categorías -->
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select mb-3" id="divisionDropdown">
                    <option selected>Elegir división...</option>
                    <!-- Cargar opciones de divisiones -->
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select mb-3" id="generoDropdown">
                    <option selected>Elegir rama...</option>
                    <!-- Cargar opciones de géneros -->
                </select>
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary mb-3" id="filterButton">Filtrar</button>
            </div>
        </div>
        <div class="alert alert-danger d-none" id="errorAlert">
            Debe completar los tres campos para filtrar
        </div>
        <table class="table table-striped" id="goleadoresTable">
            <thead class="thead-dark">
                <tr>
                    <th>Nombre</th>
                    <th>Goles</th>
                    <th>Equipo</th>
                </tr>
            </thead>
            <tbody id="goleadoresBody">
            </tbody>
        </table>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-LtrjvnR4l14N02s2U6g7Plm3JfovF2QHK03TTgF5DdFCR3e/dQDfFRY0eT1U1z7R" crossorigin="anonymous"></script> -->
    <script>
        // Cargar opciones de categorías
        var categoriasDropdown = document.getElementById('categoriasDropdown');
        var categorias = ['Mayores', 'Junior', 'Juveniles', 'Cadetes', 'Menores', 'Infantiles'];
        categorias.forEach(function(categoria) {
            var option = document.createElement('option');
            option.textContent = categoria;
            categoriasDropdown.appendChild(option);
        });

        // Cargar opciones de divisiones
        var divisionDropdown = document.getElementById('divisionDropdown');
        var divisionesMayores = ['Liga de Honor Oro', 'Liga de Honor Plata', '1°', '2°', '3°'];
        var divisionesMenores = [ 'A', 'B', 'C', 'D'];
        divisionesMayores.forEach(function(division) {
            var option = document.createElement('option');
            option.textContent = division;
            divisionDropdown.appendChild(option);
        });

        // Evento para cambiar las divisiones
        categoriasDropdown.addEventListener('change', function() {
            var categoria = this.value; // la categoría seleccionada
            divisionDropdown.innerHTML = '<option selected>Elegir división...</option>'; // limpiar las opciones actuales

            var divisiones = categoria === 'Mayores' ? divisionesMayores : divisionesMenores;

            divisiones.forEach(function(division) {
                var option = document.createElement('option');
                option.textContent = division;
                divisionDropdown.appendChild(option);
            });
        });

        // Cargar opciones de géneros
        var generoDropdown = document.getElementById('generoDropdown');
        var generos = ['Masculino', 'Femenino'];
        generos.forEach(function(genero) {
            var option = document.createElement('option');
            option.textContent = genero;
            generoDropdown.appendChild(option);
        });

        document.getElementById('filterButton').addEventListener('click', function() {
            var categoria = document.getElementById('categoriasDropdown').value;
            var division = document.getElementById('divisionDropdown').value;
            var genero = document.getElementById('generoDropdown').value;

            if (categoria === 'Elegir categoría...' || division === 'Elegir división...' || genero === 'Elegir género...') {
                document.getElementById('errorAlert').classList.remove('d-none');
            } else {
                var endpoint = 'https://api-goleadores.handball-metropolitano.com/jugador/' + division + '/' + categoria + '/' + genero;
                // var endpoint = 'http://localhost:3000/jugador/' + division + '/' + categoria + '/' + genero;
                console.log(endpoint)
                fetch(endpoint)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data)
                        var tableBody = document.getElementById('goleadoresBody');
                        tableBody.innerHTML = '';

                        data.goleadores.forEach(function(goleador) {
                            var row = document.createElement('tr');
                            var nameCell = document.createElement('td');
                            var goalsCell = document.createElement('td');
                            var teamCell = document.createElement('td');

                            nameCell.innerHTML = goleador.nombre;
                            goalsCell.innerHTML = goleador.goles;
                            teamCell.innerHTML = goleador.equipo ? goleador.equipo.nombre : 'N/A';

                            row.appendChild(nameCell);
                            row.appendChild(goalsCell);
                            row.appendChild(teamCell);
                            tableBody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }
        });
    </script>
</body>
</html>
